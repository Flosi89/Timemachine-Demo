<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Zeitreise AR</title>
  <style>
    body,html {margin:0;padding:0;height:100%;background:black;color:white;font-family:sans-serif;}
    #videoBG {position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;}
    #topbar {position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;gap:8px;z-index:10;}
    #topbar select,#topbar button {padding:6px 10px;font-size:14px;border-radius:6px;border:none;}
    #info {position:absolute;bottom:60px;left:10px;right:10px;background:rgba(0,0,0,0.7);padding:10px;border-radius:8px;}
    #slider {position:absolute;bottom:10px;left:10px;right:10px;}
    #map {position:fixed;top:0;left:0;width:100%;height:100%;display:none;z-index:20;}
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <video id="videoBG" autoplay muted playsinline></video>
  <div id="topbar">
    <select id="placeSelect"><option>Ort w√§hlen‚Ä¶</option></select>
    <button id="gpsBtn">üìç GPS</button>
    <button id="mapBtn">üó∫Ô∏è Karte</button>
  </div>
  <div id="info">
    <h3 id="placeName">Willkommen</h3>
    <p id="placeText">W√§hle einen Ort aus oder aktiviere GPS.</p>
    <button id="audioBtn">üîä Audio abspielen</button>
  </div>
  <input type="range" id="slider" min="0" max="100" value="50" />
  <div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let video=document.getElementById('videoBG');
let placeSelect=document.getElementById('placeSelect');
let placeName=document.getElementById('placeName');
let placeText=document.getElementById('placeText');
let audioBtn=document.getElementById('audioBtn');
let gpsBtn=document.getElementById('gpsBtn');
let mapBtn=document.getElementById('mapBtn');
let slider=document.getElementById('slider');
let map;
let places=[];
let currentAudio;

function log(msg){console.log(msg);}

async function loadPlaces(){
  try{
    const res=await fetch('orte.json?v='+Date.now());
    if(!res.ok) throw new Error('HTTP '+res.status);
    places=await res.json();
    if(!Array.isArray(places)||places.length===0){
      throw new Error('Leere oder ung√ºltige Liste');
    }
  }catch(e){
    places=[
      {name:'Platz 1',lat:47.0495,lng:8.3100,radius:120,text:'Fallback 1',image:'bilder/platz1.jpg'},
      {name:'Platz 2',lat:47.0450,lng:8.3130,radius:120,text:'Fallback 2',image:'bilder/platz2.jpg'}
    ];
    log('‚ùå orte.json: '+e.message+' ‚Äî Fallback geladen');
  }

  placeSelect.innerHTML='<option value="">Ort w√§hlen‚Ä¶</option>';
  places.forEach((p,i)=>{
    let opt=document.createElement('option');
    opt.value=i; opt.textContent=p.name||('Ort '+(i+1));
    placeSelect.appendChild(opt);
  });

  initMap();
}

function initMap(){
  if(!map){
    map=L.map('map').setView([47.0495,8.31],14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      attribution:'&copy; OpenStreetMap'
    }).addTo(map);
  }
  places.forEach((p,i)=>{
    L.marker([p.lat,p.lng]).addTo(map).bindPopup(p.name);
  });
}

placeSelect.addEventListener('change',()=>{
  let idx=placeSelect.value;
  if(idx==='') return;
  let p=places[idx];
  placeName.textContent=p.name;
  placeText.textContent=p.text;
});

gpsBtn.addEventListener('click',()=>{
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      let lat=pos.coords.latitude;
      let lng=pos.coords.longitude;
      log('GPS '+lat+','+lng);
    });
  }
});

mapBtn.addEventListener('click',()=>{
  let el=document.getElementById('map');
  el.style.display=(el.style.display==='none'||el.style.display==='')?'block':'none';
});

audioBtn.addEventListener('click',()=>{
  if(currentAudio){currentAudio.pause();}
  let idx=placeSelect.value;
  if(idx==='') return;
  let p=places[idx];
  if(p.audio){
    currentAudio=new Audio(p.audio);
    currentAudio.play();
  }
});

navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}})
.then(stream=>{video.srcObject=stream;})
.catch(err=>{log('Kamera-Fehler: '+err);});

loadPlaces();
</script>
</body>
</html>
