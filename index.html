<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Fr√ºher/Heute Ansicht (GPS)</title>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; font-family: system-ui, sans-serif; }
    #video, #overlay {
      position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover;
    }
    #overlay { transform-origin: center center; will-change: transform, opacity; }
    #ui { position:absolute; left:0; right:0; bottom:0; padding:12px; display:grid; gap:10px; background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.55) 40%, rgba(0,0,0,.75) 100%); z-index:10; }
    input[type=range] { width:100%; }
    .btn { appearance:none; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.1); color:#fff; padding:10px 12px; border-radius:12px; font-weight:600; }
    #hint { position:absolute; top:10px; left:10px; right:10px; color:#fff; z-index:11; background:rgba(0,0,0,.45); padding:8px 10px; border-radius:10px; font-size:14px; }
    #status { position:absolute; top:50px; left:10px; right:10px; color:#fff; background:rgba(0,0,0,.6); padding:6px 10px; border-radius:10px; font-size:13px; }
  </style>
</head>
<body>
  <div id="hint">üìç GPS-Modus: Das passende Foto wird automatisch nach Standort geladen.</div>
  <div id="status">‚è≥ Standort wird ermittelt‚Ä¶</div>
  <video id="video" autoplay playsinline webkit-playsinline muted></video>
  <img id="overlay" src="" style="opacity:0.6; display:none;">
  <div id="ui">
    <input type="range" min="0" max="100" value="60" id="opacity">
  </div>

  <script>
    const overlay = document.getElementById('overlay');
    const statusBox = document.getElementById('status');

    // Kamera starten
    (async function startCam(){
      try{
        const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:'environment'}},audio:false});
        video.srcObject=s; await video.play().catch(()=>{});
      }catch(e1){
        try{
          const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false});
          video.srcObject=s; await video.play().catch(()=>{});
        }catch(e2){
          const s=await navigator.mediaDevices.getUserMedia({video:true,audio:false});
          video.srcObject=s; await video.play().catch(()=>{});
        }
      }
    })();

    // Orte laden
    let orte = [];
    fetch('orte.json').then(r=>r.json()).then(data=>{ orte = data; });

    function distKm(lat1,lng1,lat2,lng2){
      const R=6371; // km
      const dLat=(lat2-lat1)*Math.PI/180;
      const dLon=(lng2-lng1)*Math.PI/180;
      const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
      return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
    }

    function findNearest(lat,lng){
      let best=null, bestDist=1e9;
      for(const o of orte){
        const d=distKm(lat,lng,o.lat,o.lng);
        if(d<bestDist){ bestDist=d; best=o; }
      }
      return best;
    }

    // GPS holen
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude,longitude}=pos.coords;
        statusBox.textContent='üìç Position: '+latitude.toFixed(5)+', '+longitude.toFixed(5);
        const ort=findNearest(latitude,longitude);
        if(ort){
          statusBox.textContent+=' ‚Üí N√§chster Ort: '+ort.name;
          overlay.src=ort.image+'?v='+Date.now();
          overlay.style.display='block';
        }
      }, err=>{
        statusBox.textContent='‚ùå Standort-Fehler: '+err.message;
      });
    } else {
      statusBox.textContent='‚ùå GPS nicht unterst√ºtzt';
    }

    // Opacity slider
    document.getElementById('opacity').addEventListener('input', e=>{
      overlay.style.opacity = e.target.value/100;
    });
  </script>
</body>
</html>
