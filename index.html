<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Fr√ºher/Heute Ansicht</title>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    #video, #overlay {
      position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover;
    }
    #sliderWrap { position:absolute; bottom:20px; left:0; right:0; text-align:center; z-index: 10; }
    input[type=range] { width:80%; }
    #error { position:absolute; top:10px; left:10px; right:10px; color:#fff; background:#c62828; padding:10px; display:none; z-index:1000; border-radius:8px; }
    #startBtn { position:absolute; top:10px; right:10px; z-index:1001; padding:10px 12px; border:none; border-radius:10px; background:#1976d2; color:#fff; font-weight:600; }
    #status { position:absolute; top:10px; left:10px; z-index:1002; background:rgba(0,0,0,.6); color:#fff; padding:6px 10px; border-radius:10px; font-size:13px; }
  </style>
</head>
<body>
  <div id="status">Status: ‚è≥ wartet‚Ä¶</div>
  <div id="error"></div>
  <button id="startBtn">Kamera starten</button>
  <video id="video" autoplay playsinline webkit-playsinline muted></video>
  <img id="overlay" src="alt.jpg" style="opacity:0.5">
  <div id="sliderWrap">
    <input type="range" min="0" max="100" value="50" id="slider">
  </div>

  <script>
    const video = document.getElementById('video');
    const errorBox = document.getElementById('error');
    const statusBox = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');

    async function startCamera(preferRear=true) {
      try {
        statusBox.textContent = 'Status: üé• Anfrage an Kamera‚Ä¶';
        const constraints = preferRear ? { video: { facingMode: { exact: 'environment' } }, audio: false }
                                       : { video: true, audio: false };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;
        video.muted = true; // iOS verlangt mute f√ºr Autoplay
        await video.play().catch(()=>{});
        statusBox.textContent = 'Status: ‚úÖ Kamera aktiv';
        startBtn.style.display = 'none';
      } catch (err) {
        if (preferRear) {
          // Fallback ohne exact
          try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio:false });
            video.srcObject = stream;
            video.muted = true;
            await video.play().catch(()=>{});
            statusBox.textContent = 'Status: ‚úÖ Kamera aktiv (Fallback)';
            startBtn.style.display = 'none';
            return;
          } catch (e2) {
            // Letzter Fallback: irgendeine Kamera
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio:false });
              video.srcObject = stream;
              video.muted = true;
              await video.play().catch(()=>{});
              statusBox.textContent = 'Status: ‚úÖ Kamera aktiv (irgendeine)';
              startBtn.style.display = 'none';
              return;
            } catch (e3) {
              errorBox.innerText = 'Kamera konnte nicht gestartet werden: ' + e3.message + '\nTipp: Browser-Berechtigung pr√ºfen (Schloss-Symbol) und Seite neu laden.';
              errorBox.style.display = 'block';
              statusBox.textContent = 'Status: ‚ùå Fehler';
            }
          }
        } else {
          errorBox.innerText = 'Kamera-Fehler: ' + err.message;
          errorBox.style.display = 'block';
          statusBox.textContent = 'Status: ‚ùå Fehler';
        }
      }
    }

    // Manche Browser brauchen einen Klick (User-Geste).
    startBtn.addEventListener('click', () => startCamera(true));

    // Automatisch versuchen (falls Browser es erlaubt)
    startCamera(true);

    // Slider steuert Transparenz
    const overlay = document.getElementById('overlay');
    document.getElementById('slider').addEventListener('input', e => {
      overlay.style.opacity = e.target.value / 100;
    });
  </script>
</body>
</html>
