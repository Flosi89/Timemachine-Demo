<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Zeitreise Luzern v10c</title>
  <style>
    * { box-sizing: border-box; }
    html, body { margin:0; height:100%; background:#000; font-family: system-ui, Arial, sans-serif; }
    #camera { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:0; background:#000; }
    #imageOverlay { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:5; display:none; opacity:.7; }
    #ui { position:absolute; left:0; right:0; bottom:0; padding:12px; display:grid; gap:10px;
          background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,.55) 40%, rgba(0,0,0,.8) 100%); z-index:10; }
    input[type=range] { width:100%; }
    #overlay { position:absolute; top:10px; left:10px; right:10px; color:#fff; background:rgba(0,0,0,.7); padding:8px 10px; border-radius:10px; font-size:13px; z-index:12; white-space:pre-wrap; }
    #infobox { position:absolute; left:10px; right:10px; bottom:90px; background:rgba(0,0,0,.8); color:#fff; padding:12px; border-radius:12px; z-index:20; display:none; }
    #audio-btn { margin-top:8px; padding:8px 12px; border:none; border-radius:8px; background:#1976d2; color:#fff; font-weight:600; }
    #startscreen { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:#0b0b0b; color:#fff; z-index:999; text-align:center; padding:24px; }
    #startbtn { padding:12px 20px; border:none; border-radius:12px; background:#1976d2; color:#fff; font-size:18px; font-weight:700; }
    #manualBar { position:absolute; top:10px; right:10px; z-index:15; display:flex; gap:8px; align-items:center; }
    #placeSelect, #backToGPS { padding:8px 10px; border-radius:8px; border:none; font-weight:600; }
    #placeSelect { background:#ffffff; }
    #backToGPS { background:#1976d2; color:#fff; display:none; }
  </style>
</head>
<body>
  <div id="startscreen">
    <div>
      <h2>üåç Zeitreise Luzern</h2>
      <p>Tippe auf Start und erlaube Kamera & Standort.</p>
      <button id="startbtn">Start</button>
    </div>
  </div>
  <div id="overlay" style="display:none;">‚è≥ Initialisiere‚Ä¶</div>
  <div id="manualBar" style="display:none;">
    <select id="placeSelect">
      <option value="">Ort manuell w√§hlen‚Ä¶</option>
    </select>
    <button id="backToGPS">GPS</button>
  </div>
  <video id="camera" autoplay playsinline webkit-playsinline muted></video>
  <img id="imageOverlay" alt="Historisches Overlay">
  <div id="infobox">
    <div id="info-title" style="font-weight:700;margin-bottom:6px;"></div>
    <div id="info-text" style="font-size:14px;opacity:.95;"></div>
    <button id="audio-btn">‚ñ∂Ô∏è Audio abspielen</button>
    <audio id="audio-player"></audio>
  </div>
  <div id="ui" style="display:none;">
    <input id="opacity" type="range" min="0" max="100" value="70">
  </div>
  <script>
    const camera=document.getElementById("camera"), imageOverlay=document.getElementById("imageOverlay"), overlay=document.getElementById("overlay"), infobox=document.getElementById("infobox"), infoTitle=document.getElementById("info-title"), infoText=document.getElementById("info-text"), audioBtn=document.getElementById("audio-btn"), audioPlayer=document.getElementById("audio-player"), opacitySlider=document.getElementById("opacity"), startscreen=document.getElementById("startscreen"), startbtn=document.getElementById("startbtn"), placeSelect=document.getElementById("placeSelect"), backToGPS=document.getElementById("backToGPS"), manualBar=document.getElementById("manualBar");
    let places=[], manualMode=false;
    async function startCamera(){try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:false});camera.srcObject=s;await camera.play();}catch(e){overlay.textContent="‚ùå Kamera: "+e.message;}}
    async function loadPlaces(){const res=await fetch("orte.json?v="+Date.now());places=await res.json();placeSelect.innerHTML='<option value="">Ort manuell w√§hlen‚Ä¶</option>';places.forEach((p,i)=>{const opt=document.createElement("option");opt.value=i;opt.textContent=p.name;placeSelect.appendChild(opt);});}
    function showPlace(p){imageOverlay.src=p.image;imageOverlay.style.display="block";infoTitle.textContent=p.name;infoText.textContent=p.text;audioBtn.onclick=()=>{new Audio(p.audio).play();};infobox.style.display="block";}
    startbtn.addEventListener("click",async()=>{startscreen.style.display="none";overlay.style.display="block";manualBar.style.display="flex";document.getElementById("ui").style.display="grid";await startCamera();await loadPlaces();});
    placeSelect.addEventListener("change",()=>{const idx=parseInt(placeSelect.value,10);if(!isNaN(idx)){manualMode=true;showPlace(places[idx]);overlay.textContent="üìç Manuell: "+places[idx].name;backToGPS.style.display="inline-block";}});
    backToGPS.addEventListener("click",()=>{manualMode=false;backToGPS.style.display="none";overlay.textContent="‚Ü©Ô∏è Zur√ºck zu GPS";});
    opacitySlider.addEventListener("input",()=>{imageOverlay.style.opacity=opacitySlider.value/100;});
  </script>
</body>
</html>