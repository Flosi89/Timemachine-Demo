<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timemachine Demo</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: black;
      font-family: Arial, sans-serif;
    }

    #startscreen {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #111;
      color: white;
      z-index: 10;
    }

    #startscreen h1 {
      font-size: 1.8em;
      margin-bottom: 20px;
      text-align: center;
    }

    #startscreen button {
      padding: 12px 20px;
      font-size: 1em;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }

    video {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    #overlay {
      position: absolute;
      top: 10px; left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.9em;
    }

    #infobox {
      position: absolute;
      bottom: 60px;
      left: 10px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 12px;
      border-radius: 8px;
      display: none;
    }

    #infobox h2 {
      margin: 0 0 8px 0;
      font-size: 1.2em;
    }

    #infobox button {
      margin-top: 8px;
      padding: 8px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #slider {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
    }

    #imageOverlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      display: none;
      z-index: 1;
    }
  </style>
</head>
<body>

  <!-- Startscreen -->
  <div id="startscreen">
    <h1>Vergangenheit wird lebendig</h1>
    <button onclick="startApp()">Starten</button>
  </div>

  <!-- Kamera -->
  <video id="camera" autoplay playsinline></video>

  <!-- Historisches Bild -->
  <img id="imageOverlay">

  <!-- Overlay-Infos -->
  <div id="overlay">üìç Standort wird ermittelt‚Ä¶</div>

  <!-- Infobox -->
  <div id="infobox">
    <h2 id="placeName"></h2>
    <p id="placeText"></p>
    <button id="playAudio">üîä Audio abspielen</button>
  </div>

  <!-- Slider -->
  <input id="slider" type="range" min="0" max="100" value="50">

  <script>
    let camera = document.getElementById("camera");
    let imageOverlay = document.getElementById("imageOverlay");
    let overlay = document.getElementById("overlay");
    let infobox = document.getElementById("infobox");
    let placeName = document.getElementById("placeName");
    let placeText = document.getElementById("placeText");
    let playAudio = document.getElementById("playAudio");
    let slider = document.getElementById("slider");

    let places = [];
    let currentPlace = null;

    // App starten
    async function startApp() {
      document.getElementById("startscreen").style.display = "none";
      startCamera();
      loadPlaces();
      getLocation();
    }

    // Kamera starten
    async function startCamera() {
      try {
        let stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        camera.srcObject = stream;
      } catch (e) {
        alert("Kamera konnte nicht gestartet werden: " + e);
      }
    }

    // Orte laden
    async function loadPlaces() {
      let res = await fetch("orte.json");
      places = await res.json();
    }

    // Standort pr√ºfen
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(showPosition, err => {
          overlay.innerText = "‚ö†Ô∏è Standortfehler";
        }, { enableHighAccuracy: true });
      } else {
        overlay.innerText = "‚ùå Geolocation nicht unterst√ºtzt";
      }
    }

    function showPosition(position) {
      let lat = position.coords.latitude;
      let lng = position.coords.longitude;

      let nearest = null;
      let minDist = Infinity;

      places.forEach(p => {
        let d = Math.sqrt((p.lat - lat) ** 2 + (p.lng - lng) ** 2);
        if (d < minDist) {
          minDist = d;
          nearest = p;
        }
      });

      if (nearest) {
        overlay.innerText = `üìç ${lat.toFixed(5)}, ${lng.toFixed(5)} | N√§chster Ort: ${nearest.name} (${(minDist*111).toFixed(2)} km)`;
        showPlace(nearest);
      }
    }

    function showPlace(place) {
      if (currentPlace && currentPlace.name === place.name) return;
      currentPlace = place;

      imageOverlay.src = place.image;
      imageOverlay.style.display = "block";
      infobox.style.display = "block";
      placeName.innerText = place.name;
      placeText.innerText = place.text;

      playAudio.onclick = () => {
        new Audio(place.audio).play();
      };
    }

    // Slider f√ºr Bildtransparenz
    slider.addEventListener("input", () => {
      imageOverlay.style.opacity = slider.value / 100;
    });
  </script>
</body>
</html>
